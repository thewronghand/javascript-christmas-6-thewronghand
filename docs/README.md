# 미션 - 크리스마스 프로모션

주어진 요구사항에 맞추어 크리스마스 프로모션 어플리케이션을 구현합니다.

## 🤔 요구사항 리스트

- [x] 사용자로부터 예상 방문 날짜를 숫자로 입력받는다.
- [x] 입력받은 날짜가 유효하지 않을 경우 (예: 숫자가 아닌 값 입력, 양의 정수가 아닌 값 입력, 12월에 존재하지 않는 날짜 입력) 예외를 발생시킨다.
- [x] 예외 발생의 경우 에러 메세지를 표시한 후 다시 입력받는다.
- [x] 사용자로부터 주문할 메뉴를 입력받는다.
  - [x] 메뉴는 `메뉴명 - 갯수` 형식으로 입력하고, `,`를 기준으로 구분한다.
  - [x] 메뉴판에 없는 메뉴를 입력한 경우, 메뉴 갯수 총합이 최대값(20)보다 큰 경우, 음료만 주문한 경우, 메뉴 이름을 중복으로 입력한 경우, 메뉴의 갯수로 유효하지 않은 값이 입력된 경우 예외를 발생시킨다.
  - [x] 예외 발생의 경우 에러 메세지를 표시한 후 다시 입력받는다.
- [x] 입력된 방문 날짜와 메뉴 구성, 주문 금액에 따라 다음과 같은 할인을 적용한다.
  - [x] 크리스마스 디데이 할인 : 1일부터 1000원으로 시작하여 크리스마스에 가까워질 때마다 할인금액 100원 증가 (12/1 : 1000 , 12/2 : 1100 ... 12/25: 3400)
  - [x] 평일 할인 : 평일 (일 ~ 목)에는 디저트 메뉴를 메뉴 1개당 2023원 할인
  - [x] 주말 할인 : 주말에는 메인 메뉴를 메뉴 1개당 2023원 할인
  - [x] 특별 할인 : 이벤트 달력에 별이 있는 날(3, 10, 17, 24, 25, 31)은 총 주문 금액에서 1000원 할인
  - [x] 증정 이벤트: 할인 전 총 주문 금액이 12만원 이상이면 샴페인 (25000원) 1개 증정
  - [x] 크리스마스 디데이 할인을 제외한 이벤트는 12/1 ~ 12/31까지 적용된다.
  - [x] 모든 할인 이벤트는 총 주문 금액이 1만원 이상일 때에만 적용된다.
- [x] 할인 총 혜택 금액에 따라 이벤트 배지를 부여한다.
- [x] 할인이 적용된 결과를 출력한다.
  - [x] 주문 메뉴를 메뉴명과 갯수 별로 출력한다.
  - [x] 할인 전 총 주문 금액을 출력한다.
  - [x] 증정 메뉴를 출력한다. 증정 이벤트에 해당되지 않으면 '없음'을 출력한다.
  - [x] 혜택 내역을 출력한다. 표시는 `적용된 할인명: -(할인금액)원`과 같이 한다. 적용된 혜택이 없으면 '없음' 을 출력한다.
  - [x] 총혜택 금액을 출력한다.
  - [x] 할인 후 예상 결제 금액을 출력한다.
  - [x] 12월 이벤트 배지를 표시한다. 해당 사항이 없을 경우 '없음' 을 출력한다.

## 🧐 실제 구현 사항 리스트

### 🎮 앱 세부 구현 사항

#### View

- InputView, OutputView를 각각 구현하고, View에서 이를 활용한다.
- InputView, OutputView는 각각 입/출력에 관한 가장 단순한 단위의 메서드와 유효성 검사를 제공한다.
  - InputView에서는 입력값의 형태(숫자인지, 올바른 형태의 문자열인 조합인지 등)를 검사한다.
- View에서는 비즈니스 로직에 연관된 입/출력 메서드를 제공한다.
  - 입력값의 적절한 형태로의 변환
  - 컨트롤러를 통해 모델에서 전달받은 값을 적절한 메세지 형태로 변환
  - 예약 결과 (예약 일자, 주문 메뉴, 할인 전 가격 총액)의 출력
  - 프로모션 적용 결과 (증정, 혜택, 총혜택, 예상 결제 금액, 뱃지)의 출력

#### Controller

- 컨트롤러는 View를 통해 전달받은 입력값을 처리하며, Model의 응답을 View로 출력한다.
- retryOnFailure 메서드를 활용해 입력 및 입력값의 처리에서 오류가 발생할 경우, 입력 및 입력 처리 함수를 재귀 호출하여 해당 부분에서 다시 입력받도록 처리한다.
- 입력값(날짜, 주문)을 PromotionService로 전달하고, 예약 정보를 반환받아 출력부로 넘긴다.
- 생성된 예약 정보를 기반으로 한 프로모션 적용 결과 정보를 반환받아 출력부로 넘긴다.

#### Models

##### PromotionService

- 날짜, 주문 입력을 유효성검사한다.
- 날짜 입력값(숫자)을 기반으로 사용자의 예약 일자를 나타내는 Date 객체를 생성하여 필드로 할당한다.
- 주문 입력값(배열)을 기반으로 각각의 메뉴을 Menu 인스턴스화한다.
- 주문 총액을 구하여 저장한다.
- Discounter 인스턴스를 생성하여, 필드로 가지고 있는 Benefit 인스턴스 배열을 활용해 모든 할인을 적용하고 결과를 반환한다.

##### Menu

- 입력된 메뉴명, 메뉴 갯수를 유효성검사한다.
- 메뉴명, 매뉴 갯수를 저장하고 반환한다.
- 상수로 정의된 MENU에서 메뉴의 가격을 찾아 반환한다.
- 상수로 정의된 MENU에서 메뉴의 카테고리를 찾아 반환한다.
- 카테고리를 입력받아, 현재 메뉴의 카테고리와 일치할 경우 메뉴 갯수를 반환한다.

##### Discounter

- 외부에서 주입받은 benefits 배열을 순회하며 모든 Benefit 객체의 apply 메서드를 실행하고, 그 결과값을 반환받는다.
- 총 주문 금액이 할인 적용 최소 주문액 (10000원)에 미치지 못할 경우, 어떤 할인도 적용하지 않는다.
- 각 혜택 적용 결과에서 혜택 금액, 할인 금액을 합산한다.
- 총 주문 금액에서 할인 금액을 차감하여 예상 결제 금액을 저장한다.
- 혜택 적용 결과에서 증정품을 포함하는 혜택을 찾고, 모든 증정품을 필드로 저장한다.
- 혜택 금액을 토대로 알맞는 이벤트 뱃지를 계산하여 저장한다.

##### Benefit

- Benefit 객체는 할인 유형을 나타낸다.
- 각 Benefit 객체는 #result 필드에 적용 결과를 저장한다.
- apply 메서드로 예약 정보를 매개변수로 받아 적용 결과를 업데이트하고 반환한다.
- ComplimentaryBenefit : 예약 정보의 주문 총액이 기준치보다 높을 경우, 혜택 금액에 증정품의 가액을 합산하고 결과에 증정품의 정보와 갯수를 추가하여 반환한다.
- DDayBenefit : 예약 정보의 날짜와 D-day 사이의 차이를 계산하여, 1일을 기준으로 초기값에서 시작하여 하루 가까워질 때마다 증가값을 합산한다. 예약 날짜가 D-day 이후일 경우 할인이 적용되지 않는다.
- SpecialDayBenefit : 예약 정보의 날짜가 지정된 할인 일자와 일치할 경우, 할인 금액을 결과에 합산하여 반환한다.
- WeekdayBenefit, WeekendBenefit : 예약 정보의 날짜 요일이 지정된 조건과 일치할 경우, 주문에서 지정된 카테고리의 메뉴 갯수만큼 할인 금액을 결과에 합산한다. 요일이 일치하지만 주문 내용에 지정된 카테고리의 메뉴가 없는 경우, 할인이 적용되지 않는다.
- 모든 Benefit 객체는 결과에서 할인 금액과 혜택 금액을 별도로 저장한다.

#### Utils

##### Validators

- InputViewValidator : 숫자 입력값과 문자열 입력값을 검증한다.
- PromotionServiceValidator : 날짜 입력값과 주문 입력값을 주어진 조건에 맞추어 검증한다.
- MenuValidator : 단일 주문에 대하여, 주문 메뉴명과 주문 갯수를 검증한다.

### 🛠 설계 및 구조 변경 사항

- **증정품 가액의 관리** : 증정품 가액은 혜택 금액에는 포함되지만, 실제로 증정품 가액 만큼 구매액에서 할인을 적용해서는 안된다. 기존에는 이를 처리하기 위해 **결과에 증정품을 설정할 때 증정품 가액만큼 총 혜택액을 차감하는** 로직을 적용했으나, **다른 형태로 혜택금액과 할인금액에 차이가 발생할 경우 별도의 처리가 필요**할 것이라 판단해, 확장성을 고려하여 **각 Benefit이 benefitAmount(혜택금액)와 discountAmount(할인금액)를 따로 관리하도록** 구조를 수정했다. 이 경우 할인금액과 혜택금액이 동일해도 상관없는 Benefit에서는 추가적인 연산을 해야 하지만, 증정 할인 이외에도 할인금액과 혜택금액이 일치하지 않는 할인 유형이 추가되더라도 Discounter 등의 외부 객체 로직 수정 없이 적용할 수 있다.

- **혜택 금액을 음수에서 양수로** : 기존에는 혜택금액(+할인금액)을 음수로 관리하여, 출력할 때 별도로 -기호를 붙이지 않아도 되게끔 처리했다. 그러나 혜택금액이 **음수인 것보다 양수인 편이 더 이해하기 쉽다**고 판단했고, 출력 시에만 - 기호를 붙여 출력하면 되므로 **트레이드오프도 크지 않다고 생각**하여 혜택 금액을 음수 대신 양수로 관리하도록 수정했다.

- **할인 조건은 충족하지만 실제 할인이 불가능할 경우의 처리** : 평일, 주말 할인은 **특정 카테고리의 주문 갯수만큼 할인**한다. 요일 조건이 충족되더라도 할인이 적용되는 메뉴가 주문에 포함되지 않은 경우, `평일 할인 : -0원`과 같이 부자연스럽게 출력된다. WeekDayBenefit과 WeekendBenefit에서 isApplied변수를 **benefitAmount가 0보다 큰지**로 동적으로 결정되도록 하여, 실제로 할인이 적용되지 않은 경우에는 isApplied가 false가 되므로 할인 결과가 아예 출력되지 않게 된다.

### 📝 테스트 작성 목록

- [ ] **유닛 테스트**

  - [x] validator 테스트 : 유효성 검사기가 예상대로 동작하는지 검증
    - [x] InputViewValidator 테스트
    - [x] MenuValidator 테스트
    - [x] PromotionServiceValidator 테스트
  - [x] Benefit 테스트 : 각 할인 유형 객체들이 주어진 입력에 예상한 결과를 반환하는지 검증

    - [x] ComplimentaryBenefit 테스트
    - [x] DDayBenefit 테스트 : 경계값(1일, 25일)에 따른 할인 결과, 이벤트 기간이 지난 경우(28일)에 대한 결과 검증
    - [x] SpecialDayBenefit 테스트
    - [x] WeekDayBenefit 테스트 : 적용, 미적용 테스트, 할인조건은 일치하지만 할인 적용이 안되는 경우 검증
    - [x] WeekendBenefit 테스트 : 적용, 미적용 테스트, 할인조건은 일치하지만 할인 적용이 안되는 경우 검증

  - [x] Discounter 테스트
  - [x] Menu 테스트
  - [ ] PromotionService 테스트

- [ ] **통합 테스트**
  - [ ] PromotionService - Discounter 통합 테스트
  - [ ] PromotionController - PromotionService - View 통합 테스트
